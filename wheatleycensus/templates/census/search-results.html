{% extends "census/base.html" %}
{% load static humanize %}

{% block title %}Search Results - Wheatley Census{% endblock %}

{% block content %}
<div>
  <script src="{% static 'census/js/bootstrap-modal.js' %}"></script>
  <script src="{% static 'census/js/copy_detail_edit_modal.js' %}"></script>
  <link rel="stylesheet" href="{% static 'census/css/modal.css' %}" />
  <div id="copyModal" class="modal fade" role="dialog"></div>
</div>

<!-- Search Form (Filters) -->
<div class="search-bar">
  <form method="get" class="search-form">
    <details open>
      <summary>Basic Filters</summary>
      <input type="text" name="q" placeholder="Keyword, Title, STC number…" value="{{ request.GET.q|default_if_none:'' }}" />
      <input type="text" name="year" placeholder="Year (e.g. 1623)" value="{{ request.GET.year|default_if_none:'' }}" />
    </details>
    <details>
      <summary>Provenance &amp; Author</summary>
      <input type="text" name="provenance" placeholder="Provenance" value="{{ request.GET.provenance|default_if_none:'' }}" />
      <input type="text" name="author" placeholder="Author / Printer" value="{{ request.GET.author|default_if_none:'' }}" />
    </details>
    <button type="submit" class="button">Search</button>
  </form>
</div>

<!-- Results Grid -->
<div class="results-grid">
  {% for copy in page_obj %}
    <div class="result-card">
      <a href="{% url 'copy_detail' copy.id %}">
        <div class="card-icon">
          {% if copy.issue.edition.cover_image_url %}
            <img src="{{ copy.issue.edition.cover_image_url }}" alt="{{ copy.issue.edition.title }}" />
          {% else %}
            <img src="{% static 'census/images/generic-icon.png' %}" alt="Generic Icon" />
          {% endif %}
        </div>
        <h2 class="card-title">{{ copy.issue.edition.title }}</h2>
        <p class="card-meta">Year: {{ copy.issue.year }}</p>
        <p class="card-meta">WC #: {{ copy.wc_number }}</p>
      </a>
    </div>
  {% empty %}
    <p class="sansserif" style="text-align:center; padding:20px;">No copies found.</p>
  {% endfor %}
</div>

<!-- Pagination -->
<div class="pagination">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}">« Prev</a>
  {% endif %}
  <span>Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}">Next »</a>
  {% endif %}
</div>

{% endblock content %}
