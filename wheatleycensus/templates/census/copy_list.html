{% extends "census/base.html" %}
{% load static humanize %}

{% block title %}Copies – Wheatley Census{% endblock %}

{% block content %}
<div class="outer-frame">

  <!-- Modal scripts -->
  <script src="{% static 'census/js/bootstrap-modal.js' %}"></script>
  <script src="{% static 'census/js/copy_detail_edit_modal.js' %}"></script>
  <link rel="stylesheet" href="{% static 'census/css/modal.css' %}" />
  <div id="copyModal" class="modal fade" role="dialog"></div>

  <!-- Play title header (inline, not include) -->
  <table class="play-title-header">
    <tr>
      <td rowspan="3" class="play-title-header-icon">
        <div class="play-title-icon-border">
          {% if selected_issue.edition.title.image %}
            <img class="play-title-icon"
                 src="{{ selected_issue.edition.title.image.url }}"
                 alt="{{ title.title }}">
          {% else %}
            <img class="play-title-icon-generic"
                 src="{% static icon_path %}"
                 alt="Generic icon">
          {% endif %}
        </div>
      </td>
      <td class="play-title-header">{{ title.title }}</td>
    </tr>
    <tr>
      <td class="play-issue-header">All editions</td>
    </tr>
    <tr>
      <td class="play-issue-header">Extant copies: {{ copy_count }}</td>
    </tr>
  </table>

  <!-- Copies table -->
  <table class="play-detail-set">

    <!-- 1) Always render your header in a THEAD -->
    <thead>
      <tr>
        <th class="terse">WC #</th>
        <th class="detailed">Location</th>
        <th class="even">Shelfmark</th>
        <th class="icon"></th>
        <th class="icon"></th>
        <th class="icon"></th>
      </tr>
    </thead>

    <!-- 2) Always open your TBODY -->
    <tbody>
      {% if all_copies %}
        {% for copy in all_copies %}
        <tr>
          <td>
            {% if copy.wc_number and copy.wc_number != '0' %}
              <a href="#"
                 class="copy_data"
                 data-form="{% url 'copy_data' copy.id %}">
                {{ copy.wc_number }}
              </a>
            {% endif %}
            {% if user.is_staff %}
              <span class="note">
                [<a href="{% url 'admin:wheatleycensus_copy_change' copy.id %}">
                  Edit
                </a>]
              </span>
            {% endif %}
          </td>
          <td>
            <a href="#"
               class="copy_data"
               data-form="{% url 'copy_data' copy.id %}">
              {{ copy.location.name_of_library_collection }}
            </a>
          </td>
          <td>
            {% if copy.shelfmark and copy.shelfmark != '[Shelfmark not available]' %}
              <a href="#"
                 class="copy_data"
                 data-form="{% url 'copy_data' copy.id %}">
                {{ copy.shelfmark }}
              </a>
            {% endif %}
          </td>
          <td>
            {% if copy.verification == 'U' %}
              <span class="unverified-symbol" title="Unverified">⃠</span>
            {% elif copy.verification == 'V' %}
              <span class="verified-symbol" title="Verified">✓</span>
            {% endif %}
          </td>
          <td>
            {% if copy.fragment %}
              <span class="unicode-icon" title="Fragment">
                <i class="fas fa-industry"></i>
              </span>
            {% endif %}
          </td>
          <td>
            {% if copy.digital_facsimile_url %}
              <span class="unicode-icon" title="Digital facsimile">
                <a href="{{ copy.digital_facsimile_url }}"
                   target="_blank">
                  <i class="fas fa-camera-retro"></i>
                </a>
              </span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      {% else %}
        <tr>
          <td colspan="6" style="text-align:center; padding:2rem;">
            No copies available.
          </td>
        </tr>
      {% endif %}
    </tbody>
  </table>

</div>
{% endblock content %}
